<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard | Cownect</title>
  <link href="https://fonts.googleapis.com/css2?family=Rethink+Sans&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/styles/navbar.css" />
  <link rel="stylesheet" href="/styles/dashboard.css" />
  
  <!-- Scripts -->
  <script src="/scripts/dashboard.js" defer></script>
 <script src="/scripts/navbar-component.js?v=3" defer></script>
<script src="/scripts/navbar.js?v=3" defer></script>
<script>src ="/scripts/matching-system.js" </script>
</head>

<body>
  <!-- Background blur decorations -->
  <div class="blur-decoration-left"></div>
  <div class="blur-decoration-right"></div>

  <!-- Navbar with enhanced profile circle -->


  <!-- Logout Button -->
  <div class="logout-button-container">
    <button class="logout-btn" onclick="logoutUser()" title="Logout">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
        <polyline points="16,17 21,12 16,7"/>
        <line x1="21" y1="12" x2="9" y2="12"/>
      </svg>
      Logout
    </button>
  </div>

  <!-- Dashboard Container -->
  <main class="dashboard-container">
    
    <!-- Enhanced User Profile Card -->
    <section class="user-profile-card">
      <!-- Profile Header -->
      <div class="profile-header">
        <div class="profile-image-container">
          <div class="profile-image" id="profileImage" onclick="document.getElementById('imageUpload').click()">
            <img id="profileImageDisplay" src="" alt="Profile" style="display: none; width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
            <span id="profileInitials">JD</span>
            <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
            <div class="image-upload-overlay">
              <svg width="24" height="24" fill="white" viewBox="0 0 24 24">
                <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H5C3.89 1 3 1.89 3 3V21C3 22.1 3.89 23 5 23H19C20.1 23 21 22.1 21 21V9M19 9H14V4H19V9Z"/>
              </svg>
            </div>
          </div>
        </div>
        <div class="profile-basic-info">
          <div class="user-display-name" id="userDisplayName">UC Davis Student</div>
          <div class="user-email" id="userEmail">student@ucdavis.edu</div>
          <div class="profile-completion">
            <div class="completion-bar">
              <div class="completion-fill" id="completionFill" style="width: 0%"></div>
            </div>
            <span class="completion-text" id="completionText">0% Complete</span>
          </div>
        </div>
      </div>

      <!-- Enhanced Profile Form -->
      <div class="profile-form" id="profileForm">
        
        <!-- Basic Information -->
        <div class="form-section">
          <h4>Basic Information</h4>
          
          <div class="form-row">
            <label for="profileName">Full Name *</label>
            <input type="text" id="profileName" placeholder="Your full name" maxlength="100">
          </div>

          <div class="form-row-group">
            <div class="form-row">
              <label for="profileYear">Year *</label>
              <select id="profileYear">
                <option value="">Select year</option>
                <option value="freshman">Freshman</option>
                <option value="sophomore">Sophomore</option>
                <option value="junior">Junior</option>
                <option value="senior">Senior</option>
                <option value="graduate">Graduate</option>
                <option value="phd">PhD</option>
                <option value="postdoc">Postdoc</option>
              </select>
            </div>

            <div class="form-row">
              <label for="profileMajor">Major *</label>
              <input type="text" id="profileMajor" placeholder="Computer Science" maxlength="100">
            </div>
          </div>

          <div class="form-row">
            <label for="profileBio">Bio *</label>
            <textarea id="profileBio" placeholder="Tell others about yourself..." maxlength="500" rows="3"></textarea>
          </div>

          <div class="form-row">
            <label for="profileHobbies">Interests & Hobbies</label>
            <input type="text" id="profileHobbies" placeholder="coding, music, hiking, photography" maxlength="300">
            <small>Separate with commas</small>
          </div>
        </div>

        <!-- Networking & Matching -->
        <div class="form-section">
          <h4>Networking & Matching</h4>
          
          <div class="form-row">
            <label for="profileLookingFor">Looking For</label>
            <div class="checkbox-group" id="profileLookingFor">
              <label class="checkbox-item">
                <input type="checkbox" value="study-partners"> Study Partners
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="project-collaborators"> Project Collaborators
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="research-partners"> Research Partners
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="internship-referrals"> Internship Referrals
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="mentorship"> Mentorship
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="friends"> Friends
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="networking"> Professional Networking
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="startup-cofounders"> Startup Co-founders
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="hackathon-teammates"> Hackathon Teammates
              </label>
            </div>
          </div>

          <div class="form-row">
            <label for="profileSkills">Skills You Have</label>
            <input type="text" id="profileSkills" placeholder="JavaScript, Python, React, Design, etc." maxlength="200">
            <small>Separate with commas</small>
          </div>

          <div class="form-row">
            <label for="profileLearningGoals">Want to Learn</label>
            <input type="text" id="profileLearningGoals" placeholder="Machine Learning, iOS Development, etc." maxlength="200">
            <small>What skills do you want to develop?</small>
          </div>

          <div class="form-row">
            <label for="profileAvailability">Availability</label>
            <select id="profileAvailability">
              <option value="">Select availability</option>
              <option value="very-available">Very Available</option>
              <option value="moderately-available">Moderately Available</option>
              <option value="limited-availability">Limited Availability</option>
              <option value="busy">Currently Busy</option>
            </select>
          </div>
        </div>

        <!-- Contact & Social -->
        <div class="form-section">
          <h4>Contact & Social</h4>
          
          <div class="form-row">
            <label for="profileLinkedin">LinkedIn Profile</label>
            <input type="url" id="profileLinkedin" placeholder="https://linkedin.com/in/yourname">
          </div>

          <div class="form-row">
            <label>Preferred Contact Methods</label>
            <div class="checkbox-group" id="profileContactPreferences">
              <label class="checkbox-item">
                <input type="checkbox" value="email"> Email
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="linkedin"> LinkedIn
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="discord"> Discord
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="instagram"> Instagram
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="in-person"> In Person
              </label>
            </div>
          </div>
        </div>

        <!-- Save Button -->
        <div class="profile-actions">
          <button class="save-profile-btn" id="saveProfileBtn" onclick="saveProfile()">Save Profile</button>
        </div>
      </div>
    </section>

    <!-- Saved Clubs Card -->
    <section class="saved-clubs-card">
      <h2>Saved Clubs</h2>
      <div class="saved-clubs-grid" id="savedClubsGrid">
        <div class="empty-state">
          <div class="empty-state-icon">🔖</div>
          <div class="empty-state-text">No saved clubs yet</div>
          <div class="empty-state-subtext">Explore tech clubs and bookmark your favorites!</div>
        </div>
      </div>
    </section>

    <!-- Upcoming Events Card -->
    <section class="upcoming-events-card">
      <h2>My Upcoming Events</h2>
      <div class="events-list" id="eventsList">
        <div class="empty-state">
          <div class="empty-state-icon">📅</div>
          <div class="empty-state-text">No upcoming events</div>
          <div class="empty-state-subtext">Check back later for new tech events!</div>
        </div>
      </div>
    </section>

    <!-- Test Results Card -->
    <section class="test-results-card">
      <h2>Recent Test Results</h2>
      <div class="test-results-list" id="testResultsList">
        <div class="empty-state">
          <div class="empty-state-icon">🧪</div>
          <div class="empty-state-text">No test results yet</div>
          <div class="empty-state-subtext">Take a niche quiz to discover your ideal career path!</div>
        </div>
      </div>
    </section>

    <!-- Potential Matches Card -->
    <section class="potential-matches-card">
      <h2>Potential Matches</h2>
      <div class="matches-list" id="matchesList">
        <div class="empty-state">
          <div class="empty-state-icon">🤝</div>
          <div class="empty-state-text">Complete your profile to find matches</div>
          <div class="empty-state-subtext">Add your interests and goals to connect with similar students!</div>
        </div>
      </div>
      <button class="view-all-matches-btn" onclick="showMatchingModal()" style="display: none;">View All Matches</button>
    </section>

     <section class="connections-card">
      <h2>🤝 Connection Requests</h2>
      <div id="connectionsList" class="connections-list">
        <div class="empty-state">
          <div class="empty-state-icon">📬</div>
          <div class="empty-state-text">No connection requests yet</div>
          <div class="empty-state-subtext">When someone wants to connect, you'll see it here!</div>
        </div>
      </div>
    </section>

  </main>

  <!-- Matching Modal -->
  <div class="modal-overlay" id="matchingModal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Find Your Perfect Study/Project Partners</h3>
        <button class="modal-close" onclick="closeMatchingModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="match-filters">
          <select id="matchFilterLookingFor">
            <option value="">What are they looking for?</option>
            <option value="study-partners">Study Partners</option>
            <option value="project-collaborators">Project Collaborators</option>
            <option value="research-partners">Research Partners</option>
            <option value="friends">Friends</option>
          </select>
          <select id="matchFilterMajor">
            <option value="">Any Major</option>
            <option value="Computer Science">Computer Science</option>
            <option value="Engineering">Engineering</option>
            <option value="Data Science">Data Science</option>
          </select>
          <select id="matchFilterYear">
            <option value="">Any Year</option>
            <option value="freshman">Freshman</option>
            <option value="sophomore">Sophomore</option>
            <option value="junior">Junior</option>
            <option value="senior">Senior</option>
            <option value="graduate">Graduate</option>
          </select>
          <button onclick="findMatches()">Find Matches</button>
        </div>
        <div class="matches-results" id="matchesResults">
          <!-- Matches will be populated here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-overlay" id="loadingOverlay" style="display: none;">
    <div class="loading-spinner"></div>
    <div class="loading-text">Loading your dashboard...</div>
  </div>

  <script>
    // Global functions for HTML handlers
    function logoutUser() {
      if (confirm('Are you sure you want to logout?')) {
        window.location.href = '/logout';
      }
    }

    function goToDashboard() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function showMatchingModal() {
      document.getElementById('matchingModal').style.display = 'flex';
    }

    function closeMatchingModal() {
      document.getElementById('matchingModal').style.display = 'none';
    }

    async function findMatches() {
      const lookingFor = document.getElementById('matchFilterLookingFor').value;
      const major = document.getElementById('matchFilterMajor').value;
      const year = document.getElementById('matchFilterYear').value;

      try {
        const params = new URLSearchParams();
        if (lookingFor) params.append('lookingFor', lookingFor);
        if (major) params.append('major', major);
        if (year) params.append('year', year);

        const response = await fetch(`/api/user/matches?${params}`);
        const data = await response.json();

        displayMatches(data.matches);
      } catch (error) {
        console.error('Error finding matches:', error);
      }
    }

    function displayMatches(matches) {
      const resultsContainer = document.getElementById('matchesResults');
      
      if (matches.length === 0) {
        resultsContainer.innerHTML = '<p>No matches found. Try adjusting your filters!</p>';
        return;
      }

      resultsContainer.innerHTML = matches.map(match => `
        <div class="match-card">
          <div class="match-avatar">
            ${match.profilePictureUrl ? 
              `<img src="${match.profilePictureUrl}" alt="${match.displayName}">` :
              `<span>${match.displayName.split(' ').map(n => n[0]).join('').toUpperCase()}</span>`
            }
          </div>
          <div class="match-info">
            <h4>${match.displayName}</h4>
            <p class="match-details">${match.year} • ${match.major}</p>
            <p class="match-bio">${match.bio}</p>
            <div class="match-tags">
              ${(match.skills || []).slice(0, 3).map(skill => `<span class="tag">${skill}</span>`).join('')}
            </div>
            <p class="match-score">Match Score: ${match.matchScore}%</p>
          </div>
        </div>
      `).join('');
    }

    // Make functions global
    window.logoutUser = logoutUser;
    window.goToDashboard = goToDashboard;
    window.showMatchingModal = showMatchingModal;
    window.closeMatchingModal = closeMatchingModal;
    window.findMatches = findMatches;
  </script>

</body>

</html>