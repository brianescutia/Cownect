<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cownect - Sign Up</title>
  <link rel="stylesheet" href="../styles/signup.css">
  <link href="https://fonts.googleapis.com/css2?family=Rethink+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="../scripts/login.js" defer></script>
  <script src="../scripts/themeToggle.js" defer></script>
</head>

<body>
  <!-- Header Logo -->
  <div class="header-logo">
    <img src="../assets/COW.png" alt="Cownect Logo featuring a cow">
  </div>

  <div class="main-container">
    <!-- Left Side - Login Form -->
    <div class="left-side">
      <div class="login-form-container">
        <!-- Welcome Text -->
        <div class="welcome-text">
          <h2>Get Started </h2>
          <p>Welcome to Cownect, Let’s create your account!</p>
        </div>

        <!-- Separator Line -->
        <div class="separator"></div>

        <!-- Error/Success Messages -->
        <div id="messageContainer"></div>

        <!-- Login Form -->
        <form method="POST" action="/signup" id="signupForm">
          <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" required placeholder="user@ucdavis.edu">
          </div>

          <div class="form-group">
            <div class="password-header">
              <label for="password">Password</label>
            </div>
            <input type="password" id="password" name="password" required placeholder="••••••••" minlength="6">
          </div>

          <button type="submit" class="sign-in-btn">Sign up</button>
        </form>

        <!-- Sign up link -->
        <div class="signup-link">
          Already have an account? <a href="../pages/login.html">Sign in</a>
        </div>
      </div>
    </div>

    <!-- Right Side - Blue Border with Laptop Image -->
    <div class="right-side">
      <div class="border-container">
        <img src="../assets/clay.png" alt="Laptop design" class="clay-image">
      </div>
    </div>
  </div>

  <script>
    // Handle URL parameters for error/success messages
    const urlParams = new URLSearchParams(window.location.search);
    const showError = urlParams.get('error');
    const email = urlParams.get('email');
    const verified = urlParams.get('verified');
    const messageContainer = document.getElementById('messageContainer');

    // Show success message if just verified
    if (verified === 'true') {
      showMessage("✅ Email verified successfully! You can now log in.", 'success');
    }

    // Show various error messages
    if (showError) {
      let errorMessage = "";
      switch (showError) {
        case 'exists':
          errorMessage = "An account with this email already exists. Please sign in instead.";
          break;
        case 'email':
          errorMessage = "Please use your UC Davis email address (@ucdavis.edu).";
          break;
        case 'server':
          errorMessage = "Server error occurred. Please try again later.";
          break;
        default:
          errorMessage = "An error occurred during signup. Please try again.";
      }
      showMessage("❌ " + errorMessage, 'error');
    }

    // Handle verification errors
    const verificationError = urlParams.get('verification_error');
    if (verificationError) {
      let errorMessage = "";
      switch (verificationError) {
        case 'missing_token':
          errorMessage = "Invalid verification link. Please request a new one.";
          break;
        case 'invalid_token':
          errorMessage = "Verification link has expired. Please request a new one.";
          break;
        default:
          errorMessage = "Verification error. Please try again.";
      }
      showMessage("❌ " + errorMessage, 'error');
    }

    function showMessage(message, type) {
      const messageDiv = document.createElement('div');
      messageDiv.className = type === 'success' ? 'success-message' : 'error-message';
      messageDiv.textContent = message;
      messageContainer.appendChild(messageDiv);
    }

    // Handle form submission (keep existing login functionality)
    document.getElementById('loginForm').addEventListener('submit', function(e) {
      // Your existing login submission logic can go here
      // For now, let the form submit normally
    });
  </script>
</body>

</html>