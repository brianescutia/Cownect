<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cownect - Sign Up</title>
  <link rel="stylesheet" href="../styles/signup.css">
  <link href="https://fonts.googleapis.com/css2?family=Rethink+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="../scripts/login.js" defer></script>
</head>

<body>
  <!-- Header Logo -->
  <div class="header-logo">
    <img src="../assets/COW.png" alt="Cownect Logo featuring a cow">
  </div>

  <div class="main-container">
    <!-- Left Side - Signup Form -->
    <div class="left-side">
      <div class="login-form-container">
        <!-- Welcome Text -->
        <div class="welcome-text">
          <h2>Join Cownect!</h2>
          <p>Create your account to discover UC Davis tech clubs</p>
        </div>

        <!-- Separator Line -->
        <div class="separator"></div>

        <!-- Error/Success Messages -->
        <div id="messageContainer"></div>

        <!-- Signup Form -->
        <form method="POST" action="/signup" id="signupForm">
          <div class="form-group">
            <label for="email">UC Davis Email</label>
            <input type="email" id="email" name="email" required placeholder="yourname@ucdavis.edu">
            <small style="color: #666; font-size: 0.8rem;">Must be a valid @ucdavis.edu email address</small>
          </div>

          <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" name="password" required placeholder="••••••••">
            <small style="color: #666; font-size: 0.8rem;">Minimum 6 characters</small>
          </div>

          <button type="submit" class="sign-in-btn">Create Account</button>
        </form>

        <!-- Login link -->
        <div class="signup-link">
          Already have an account? <a href="/login">Sign in</a>
        </div>
      </div>
    </div>

    <!-- Right Side - Blue Border with Laptop Image -->
    <div class="right-side">
      <div class="border-container">
        <img src="../assets/clay.png" alt="Laptop design" class="clay-image">
      </div>
    </div>
  </div>

  <script>
    // Handle URL parameters for error messages
    const urlParams = new URLSearchParams(window.location.search);
    const showError = urlParams.get('error');
    const messageContainer = document.getElementById('messageContainer');

    // Show various error messages
    if (showError) {
      let errorMessage = "";
      switch (showError) {
        case 'missing_fields':
          errorMessage = "Please fill in all required fields.";
          break;
        case 'invalid_domain':
          errorMessage = "Please use your UC Davis email address (@ucdavis.edu).";
          break;
        case 'weak_password':
          errorMessage = "Password must be at least 6 characters long.";
          break;
        case 'account_exists':
          errorMessage = "An account with this email already exists. Please log in instead.";
          break;
        case 'validation_error':
          errorMessage = "Please check your information and try again.";
          break;
        case 'server_error':
          errorMessage = "Server error occurred. Please try again later.";
          break;
        default:
          errorMessage = "An error occurred. Please try again.";
      }
      showMessage("❌ " + errorMessage, 'error');
    }

    function showMessage(message, type) {
      const messageDiv = document.createElement('div');
      messageDiv.className = type === 'success' ? 'success-message' : 'error-message';
      messageDiv.textContent = message;
      messageContainer.appendChild(messageDiv);

      // Auto-hide after 7 seconds
      setTimeout(() => {
        if (messageDiv.parentNode) {
          messageDiv.remove();
        }
      }, 7000);
    }

    // Pre-fill email field if redirected back with error
    const emailInput = document.getElementById('email');
    const savedEmail = urlParams.get('email');
    if (savedEmail && emailInput) {
      emailInput.value = decodeURIComponent(savedEmail);
    }

    // Focus appropriate field
    if (showError === 'weak_password') {
      document.getElementById('password').focus();
    } else if (!emailInput.value) {
      emailInput.focus();
    } else {
      document.getElementById('password').focus();
    }
  </script>
</body>

</html>