<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cownect - Sign In</title>
  <link rel="stylesheet" href="../styles/login.css">
  <link href="https://fonts.googleapis.com/css2?family=Rethink+Sans:wght@400;500;600&display=swap" rel="stylesheet">
</head>

<body>
  <!-- Header Logo -->
  <div class="header-logo">
    <img src="../assets/COW.png" alt="Cownect Logo featuring a cow">
  </div>

  <div class="main-container">
    <!-- Left Side - Login Options -->
    <div class="left-side">
      <div class="login-form-container">
        <!-- Welcome Text -->
        <div class="welcome-text">
          <h2>Welcome to Cownect!</h2>
          <p>Sign in with your UC Davis Google account to discover tech clubs</p>
        </div>

        <!-- Separator Line -->
        <div class="separator"></div>

        <!-- Error/Success Messages -->
        <div id="messageContainer"></div>

        <!-- Google Sign-In Button -->
        <div class="google-signin-container">
          <a href="/auth/google" class="google-signin-btn">
            <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google" class="google-logo">
            <span>Continue with Google</span>
          </a>
          
          <p class="signin-note">
            🎓 Use your <strong>@ucdavis.edu</strong> email address
          </p>
        </div>

        <!-- Benefits Section -->
        <div class="benefits-section">
          <h3>Why use Google Sign-In?</h3>
          <ul class="benefits-list">
            <li>✅ <strong>Secure:</strong> No passwords to remember</li>
            <li>🚀 <strong>Fast:</strong> One-click authentication</li>
            <li>🔒 <strong>Safe:</strong> Protected by Google's security</li>
            <li>🎯 <strong>Simple:</strong> Use your existing UC Davis account</li>
          </ul>
        </div>

        <!-- Help Section -->
        <div class="help-section">
          <details class="help-details">
            <summary>Need Help?</summary>
            <div class="help-content">
              <p><strong>Can't sign in?</strong></p>
              <ul>
                <li>Make sure you're using your <code>@ucdavis.edu</code> email</li>
                <li>Check that you're signed into the correct Google account</li>
                <li>Try signing out of Google and signing back in</li>
                <li>Contact support if you're still having issues</li>
              </ul>
            </div>
          </details>
        </div>
      </div>
    </div>

    <!-- Right Side - Blue Border with Laptop Image -->
    <div class="right-side">
      <div class="border-container">
        <img src="../assets/clay.png" alt="Laptop design" class="clay-image">
      </div>
    </div>
  </div>

  <script>
    // Handle URL parameters for error/success messages
    const urlParams = new URLSearchParams(window.location.search);
    const showError = urlParams.get('error');
    const verified = urlParams.get('verified');
    const messageContainer = document.getElementById('messageContainer');

    // Show success message if just verified or signed up
    if (verified === 'true') {
      showMessage("✅ Account verified successfully!", 'success');
    }

    // Show various error messages
    if (showError) {
      let errorMessage = "";
      switch (showError) {
        case 'oauth_failed':
          errorMessage = "Sign-in failed. Please try again or make sure you're using your UC Davis email.";
          break;
        case 'access_denied':
          errorMessage = "Sign-in was cancelled. Please try again to access Cownect.";
          break;
        case 'invalid_email':
          errorMessage = "Please use your UC Davis email address (@ucdavis.edu) to sign in.";
          break;
        default:
          errorMessage = "An error occurred during sign-in. Please try again.";
      }
      showMessage("❌ " + errorMessage, 'error');
    }

    function showMessage(message, type) {
      const messageDiv = document.createElement('div');
      messageDiv.className = type === 'success' ? 'success-message' : 'error-message';
      messageDiv.textContent = message;
      messageContainer.appendChild(messageDiv);

      // Auto-hide after 7 seconds
      setTimeout(() => {
        if (messageDiv.parentNode) {
          messageDiv.remove();
        }
      }, 7000);
    }

    // Add loading state to Google sign-in button
    const googleBtn = document.querySelector('.google-signin-btn');
    googleBtn.addEventListener('click', function() {
      this.style.opacity = '0.8';
      this.style.cursor = 'wait';
      
      const span = this.querySelector('span');
      const originalText = span.textContent;
      span.textContent = 'Redirecting to Google...';
      
      // Reset after 5 seconds in case user comes back
      setTimeout(() => {
        this.style.opacity = '1';
        this.style.cursor = 'pointer';
        span.textContent = originalText;
      }, 5000);
    });
  </script>
</body>

</html>