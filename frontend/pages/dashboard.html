<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard | Cownect</title>
  <link href="https://fonts.googleapis.com/css2?family=Rethink+Sans&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/styles/dashboard.css" />
  
  <!-- Scripts -->
  <script src="/scripts/bookmark.js" defer></script>
  <script src="/scripts/events-calendar.js" defer></script>
  <script src="/scripts/events.js" defer></script>
  <script src="/scripts/dashboard.js" defer></script>
</head>

<body>
  <!-- Background blur decorations -->
  <div class="blur-decoration-left"></div>
  <div class="blur-decoration-right"></div>

  <!-- Navbar - updated with profile circle outside gray background -->
  <nav class="navbar">
    <div class="navbar-container">
      <div class="logo-title">
        <img src="../assets/cowLogo.png" alt="Cownect Logo" class="logo" />
        <span class="logo-text">Cownect</span>
      </div>
      <ul class="nav-links">
        <li><a href="../pages/tech-clubs.html">Tech Clubs</a></li>
        <li><a href="/events" class="nav-link">Events</a></li>
        <li><a href="/niche-landing">Niche Test</a></li>
        <li><a href="#">Mentor Matching</a></li>
      </ul>
    </div>
    <!-- Profile circle outside of the gray background -->
    <div class="navbar-profile-circle" id="navbarProfileCircle" onclick="goToDashboard()" title="Dashboard">
      <span id="navbarProfileInitials">JD</span>
    </div>
  </nav>

  <!-- Logout Button - positioned in top right -->
  <div class="logout-button-container">
    <button class="logout-btn" onclick="logoutUser()" title="Logout">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
        <polyline points="16,17 21,12 16,7"/>
        <line x1="21" y1="12" x2="9" y2="12"/>
      </svg>
      Logout
    </button>
  </div>

  <!-- Dashboard Container with New Layout -->
  <main class="dashboard-container">
    
    <!-- User Profile Card - Left Half, Top -->
    <section class="user-profile-card">
      <div class="profile-image-container">
        <div class="profile-image" id="profileImage" onclick="document.getElementById('imageUpload').click()">
          <span id="profileInitials">JD</span>
          <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
        </div>
      </div>
      <div class="profile-info">
        <div class="user-major" id="userMajor">Computer Science</div>
        <div class="user-email" id="userEmail">john.doe@ucdavis.edu</div>
        <div class="profile-actions">
          <button class="edit-profile-btn" onclick="editProfile()">Edit Profile</button>
        </div>
      </div>
    </section>

    <!-- Saved Clubs Card - Right Half, Top -->
    <section class="saved-clubs-card">
      <h2>Saved Clubs</h2>
      <div class="saved-clubs-grid" id="savedClubsGrid">
        <!-- Sample saved clubs -->
        <div class="mini-club-card">
          <div class="mini-club-logo"></div>
          <div class="mini-club-name">#include</div>
          <div class="mini-club-description">Build real-world coding projects</div>
          <div class="mini-club-tags">#software #webdev</div>
        </div>
        <div class="mini-club-card">
          <div class="mini-club-logo"></div>
          <div class="mini-club-name">AI Student Collective</div>
          <div class="mini-club-description">Machine learning and NLP</div>
          <div class="mini-club-tags">#AI #ML #Python</div>
        </div>
        <div class="mini-club-card">
          <div class="mini-club-logo"></div>
          <div class="mini-club-name">AggieWorks</div>
          <div class="mini-club-description">Electronics and microcontrollers</div>
          <div class="mini-club-tags">#hardware #arduino</div>
        </div>
      </div>
    </section>

    <!-- Upcoming Events Card - Right Half, Middle -->
    <section class="upcoming-events-card">
      <h2>My Upcoming Events</h2>
      <div class="events-list" id="eventsList">
        <!-- Sample events -->
        <div class="event-item">
          <div class="event-date">
            <div class="event-date-day">15</div>
            <div class="event-date-month">Aug</div>
          </div>
          <div class="event-details">
            <div class="event-name">Weekly Coding Workshop</div>
            <div class="event-club">#include - 6:00 PM</div>
          </div>
        </div>
        <div class="event-item">
          <div class="event-date">
            <div class="event-date-day">18</div>
            <div class="event-date-month">Aug</div>
          </div>
          <div class="event-details">
            <div class="event-name">AI Research Presentation</div>
            <div class="event-club">AI Student Collective - 4:30 PM</div>
          </div>
        </div>
        <div class="event-item">
          <div class="event-date">
            <div class="event-date-day">22</div>
            <div class="event-date-month">Aug</div>
          </div>
          <div class="event-details">
            <div class="event-name">Hardware Demo Day</div>
            <div class="event-club">AggieWorks - 3:00 PM</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Test Results Card - Left Half, Bottom -->
    <section class="test-results-card">
      <h2>Recent Test Results</h2>
      <div class="test-results-list" id="testResultsList">
        <!-- Sample test results -->
        <div class="test-result-item">
          <div class="test-info">
            <div class="test-name">Career Interest Assessment</div>
            <div class="test-date">July 28, 2025</div>
          </div>
          <div class="test-score">85%</div>
        </div>
        <div class="test-result-item">
          <div class="test-info">
            <div class="test-name">Technical Skills Evaluation</div>
            <div class="test-date">July 20, 2025</div>
          </div>
          <div class="test-score">92%</div>
        </div>
        <div class="test-result-item">
          <div class="test-info">
            <div class="test-name">Leadership Style Quiz</div>
            <div class="test-date">July 15, 2025</div>
          </div>
          <div class="test-score">78%</div>
        </div>
      </div>
    </section>

    <!-- Empty Space - Right Half, Bottom (intentionally blank) -->
    <section class="empty-space-card">
      <!-- Intentionally left blank as requested -->
    </section>

  </main>

  <!-- Loading State -->
  <div class="loading-overlay" id="loadingOverlay" style="display: none;">
    <div class="loading-spinner"></div>
    <div class="loading-text">Loading your dashboard...</div>
  </div>

  <script>
    // Function to handle user logout
    function logoutUser() {
      if (confirm('Are you sure you want to logout?')) {
        console.log('ðŸšª User logging out...');
        
        // Show loading state
        const loadingOverlay = document.getElementById('loadingOverlay');
        if (loadingOverlay) {
          loadingOverlay.style.display = 'flex';
        }
        
        // Redirect to logout endpoint
        window.location.href = '/logout';
      }
    }

    // Function to navigate to dashboard (for navbar profile circle)
    function goToDashboard() {
      // Already on dashboard, just scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Initialize navbar profile on dashboard
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        const response = await fetch('/api/user');
        if (response.ok) {
          const userData = await response.json();
          
          if (userData.isLoggedIn) {
            // Update navbar profile initials
            const navbarInitials = document.getElementById('navbarProfileInitials');
            if (navbarInitials && userData.email) {
              const emailPrefix = userData.email.split('@')[0];
              const initials = emailPrefix.substring(0, 2).toUpperCase();
              navbarInitials.textContent = initials;
            }
          }
        }
      } catch (error) {
        console.error('Error loading user data for navbar:', error);
      }
    });

    // Global functions for HTML onclick handlers
    window.logoutUser = logoutUser;
    window.goToDashboard = goToDashboard;
  </script>

</body>

</html>